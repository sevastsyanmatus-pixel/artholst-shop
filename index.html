<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARTHOLST ‚Äî –ü–µ—á–∞—Ç—å –Ω–∞ —Ö–æ–ª—Å—Ç–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ==================== RESET ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==================== */
        :root {
            /* –§–æ–Ω—ã */
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: #2a2a2a;
            
            /* –¢–µ–∫—Å—Ç */
            --text-primary: #FFFFFF;
            --text-secondary: #999999;
            --text-muted: #666666;
            
            /* –ê–∫—Ü–µ–Ω—Ç—ã */
            --color-orange: #ff6b35;
            --color-orange-light: #f7931e;
            --color-purple: #764ba2;
            --color-purple-light: #667eea;
            
            /* –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã */
            --gradient-main: linear-gradient(135deg, #ff6b35 0%, #764ba2 100%);
            --gradient-orange: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            --gradient-purple: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            
            /* –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ */
            --color-success: #51cf66;
            --color-error: #ff6b6b;
            
            /* –†–∞–∑–º–µ—Ä—ã */
            --header-height: 60px;
            --border-radius: 16px;
            --border-radius-sm: 12px;
        }

        /* ==================== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ==================== */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Montserrat', 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        /* ==================== –£–¢–ò–õ–ò–¢–´ ==================== */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeInUp 0.4s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ==================== HEADER ==================== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid transparent;
            border-image: var(--gradient-main) 1;
        }

        .logo {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 3px;
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 24px;
            transition: transform 0.2s;
        }

        .cart-icon:active {
            transform: scale(0.9);
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--gradient-orange);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
        }

        /* ==================== BACK BUTTON ==================== */
        .back-button {
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .back-button:active {
            transform: scale(0.9);
        }

        /* ==================== –ë–ê–ù–ù–ï–†–´ ==================== */
        .banners-section {
            padding: 20px;
            overflow: hidden;
        }

        .banners-slider {
            position: relative;
            height: 160px;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .banner-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease;
            cursor: pointer;
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .banner-slide.active {
            opacity: 1;
        }

        .banner-content {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .banner-icon {
            font-size: 48px;
            flex-shrink: 0;
        }

        .banner-text h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .banner-text p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .banner-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 16px;
        }

        .banner-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .banner-dot.active {
            background: var(--color-orange);
            width: 24px;
            border-radius: 4px;
        }

        /* ==================== –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê ==================== */
        .advantages-section {
            padding: 40px 20px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 24px;
            position: relative;
            padding-bottom: 12px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--gradient-main);
            border-radius: 2px;
        }

        .advantages-scroll {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding-bottom: 16px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .advantages-scroll::-webkit-scrollbar {
            display: none;
        }

        .advantage-card {
            min-width: 140px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .advantage-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: var(--border-radius);
            padding: 2px;
            background: var(--gradient-main);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .advantage-card:hover::before {
            opacity: 1;
        }

        .advantage-card:active {
            transform: scale(0.95);
        }

        .advantage-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .advantage-text {
            font-size: 13px;
            line-height: 1.4;
        }

        /* ==================== –ö–ê–¢–ê–õ–û–ì ==================== */
        .catalog-section {
            padding: 20px;
        }

        .sizes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .size-card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 16px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .size-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.15);
        }

        .size-badges {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .size-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }

        .badge-hit {
            background: var(--gradient-orange);
        }

        .badge-popular {
            background: var(--gradient-purple);
        }

        .size-canvas-icon {
            width: 100%;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }

        .canvas-frame {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .size-name {
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 8px;
        }

        .size-price {
            font-size: 28px;
            font-weight: 700;
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 12px;
        }

        .size-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 12px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .size-info:hover {
            color: var(--color-orange);
        }

        .add-to-cart-btn {
            width: 100%;
            padding: 12px;
            background: var(--gradient-main);
            border: none;
            border-radius: var(--border-radius-sm);
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .add-to-cart-btn:active {
            transform: scale(0.98);
        }

        .add-to-cart-btn.added {
            background: var(--color-success);
            animation: pulse 0.3s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.95); }
        }

        /* Ripple —ç—Ñ—Ñ–µ–∫—Ç */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: scale(0);
            animation: ripple-animation 0.6s ease-out;
        }

        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ==================== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 28px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s;
            line-height: 1;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: white;
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-right: 40px;
        }

        .modal-icon {
            font-size: 36px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
        }

        .modal-body {
            color: var(--text-secondary);
            line-height: 1.8;
            white-space: pre-line;
        }

        .modal-promo {
            margin-top: 20px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: var(--border-radius-sm);
            text-align: center;
        }

        .promo-code {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-orange);
            margin: 8px 0;
            letter-spacing: 2px;
        }

        .copy-promo-btn {
            margin-top: 12px;
            padding: 10px 24px;
            background: var(--gradient-orange);
            border: none;
            border-radius: var(--border-radius-sm);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .copy-promo-btn:active {
            transform: scale(0.95);
        }

        /* ==================== –ö–û–†–ó–ò–ù–ê ==================== */
        .cart-page {
            padding: 20px;
            padding-bottom: 200px;
        }

        .cart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .cart-title {
            font-size: 24px;
            font-weight: 700;
        }

        .clear-cart-btn {
            color: var(--color-orange);
            background: none;
            border: none;
            font-size: 15px;
            cursor: pointer;
            font-weight: 600;
        }

        .cart-empty {
            text-align: center;
            padding: 60px 20px;
        }

        .cart-empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .cart-empty-text {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .cart-item {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        .cart-item-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }

        .cart-item-icon {
            font-size: 48px;
            flex-shrink: 0;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-size {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .cart-item-price {
            font-size: 20px;
            font-weight: 700;
            background: var(--gradient-orange);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .cart-item-delete {
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s;
        }

        .cart-item-delete:hover {
            color: var(--color-error);
        }

        .packaging-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            margin-bottom: 12px;
            cursor: pointer;
        }

        .toggle-switch {
            width: 48px;
            height: 26px;
            background: var(--text-muted);
            border-radius: 13px;
            position: relative;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: var(--gradient-orange);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(22px);
        }

        .toggle-label {
            flex: 1;
            font-size: 14px;
        }

        .toggle-price {
            font-weight: 700;
            color: var(--color-orange);
        }

        .cart-item-comment {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--text-muted);
            border-radius: var(--border-radius-sm);
            padding: 12px;
            color: white;
            font-size: 14px;
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }

        .cart-item-comment:focus {
            outline: none;
            border-color: var(--color-orange);
        }

        .cart-item-comment::placeholder {
            color: var(--text-muted);
        }

        .photo-note {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .add-more-btn {
            width: 100%;
            padding: 16px;
            background: transparent;
            border: 2px solid var(--color-orange);
            border-radius: var(--border-radius-sm);
            color: var(--color-orange);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin: 24px 0;
            transition: all 0.3s;
        }

        .add-more-btn:hover {
            background: var(--color-orange);
            color: white;
        }

        .promo-section {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 24px;
        }

        .promo-input-group {
            display: flex;
            gap: 12px;
        }

        .promo-input {
            flex: 1;
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--text-muted);
            border-radius: var(--border-radius-sm);
            color: white;
            font-size: 14px;
        }

        .promo-input:focus {
            outline: none;
            border-color: var(--color-orange);
        }

        .promo-apply-btn {
            padding: 12px 20px;
            background: var(--gradient-orange);
            border: none;
            border-radius: var(--border-radius-sm);
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .promo-message {
            margin-top: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
        }

        .promo-message.success {
            background: rgba(81, 207, 102, 0.1);
            color: var(--color-success);
        }

        .promo-message.error {
            background: rgba(255, 107, 107, 0.1);
            color: var(--color-error);
        }

        /* ==================== –ò–¢–û–ì–û–í–ê–Ø –ü–õ–ê–®–ö–ê ==================== */
        .cart-summary {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 2px solid;
            border-image: var(--gradient-main) 1;
            padding: 16px 20px;
            z-index: 50;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-row.discount {
            color: var(--color-success);
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--text-muted);
            margin-top: 8px;
        }

        .summary-total-label {
            font-size: 18px;
            font-weight: 700;
        }

        .summary-total-price {
            font-size: 28px;
            font-weight: 700;
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .checkout-btn {
            width: 100%;
            padding: 16px;
            background: var(--gradient-main);
            border: none;
            border-radius: var(--border-radius-sm);
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 12px;
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 4px 16px rgba(255, 107, 53, 0.3);
            }
            50% {
                box-shadow: 0 4px 24px rgba(255, 107, 53, 0.5);
            }
        }

        /* ==================== –û–§–û–†–ú–õ–ï–ù–ò–ï ==================== */
        .checkout-page {
            padding: 20px;
            padding-bottom: 100px;
        }

        .progress-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding: 0 20px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
            flex: 1;
        }

        .progress-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            z-index: 2;
            transition: all 0.3s;
        }

        .progress-step.active .progress-circle {
            background: var(--gradient-orange);
            transform: scale(1.1);
        }

        .progress-step.completed .progress-circle {
            background: var(--color-success);
        }

        .progress-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-align: center;
        }

        .progress-step.active .progress-label {
            color: var(--color-orange);
            font-weight: 600;
        }

        .progress-line {
            position: absolute;
            top: 18px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: var(--text-muted);
            z-index: 1;
        }

        .progress-step:last-child .progress-line {
            display: none;
        }

        .progress-step.completed .progress-line {
            background: var(--color-success);
        }

        .checkout-form {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
        }

        .form-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 0;
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--text-muted);
            color: white;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-bottom: 2px solid var(--color-orange);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-input.error {
            border-bottom-color: var(--color-error);
        }

        .error-message {
            color: var(--color-error);
            font-size: 12px;
            margin-top: 4px;
        }

        .delivery-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .delivery-option {
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.3s;
        }

        .delivery-option.selected {
            border-color: var(--color-orange);
            background: rgba(255, 107, 53, 0.05);
        }

        .delivery-option-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .delivery-option-name {
            font-weight: 600;
            font-size: 15px;
        }

        .delivery-option-price {
            font-weight: 700;
            color: var(--color-orange);
        }

        .delivery-badge {
            padding: 4px 12px;
            background: var(--color-success);
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
        }

        .delivery-option-details {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .delivery-fields {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--text-muted);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-card);
            border-radius: 8px;
            cursor: pointer;
            margin-top: 12px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .next-step-btn,
        .prev-step-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .next-step-btn {
            background: var(--gradient-main);
            color: white;
            margin-bottom: 12px;
        }

        .prev-step-btn {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--text-muted);
        }

        .next-step-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ==================== –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï ==================== */
        .confirmation-card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 16px;
        }

        .confirmation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .confirmation-title {
            font-size: 16px;
            font-weight: 700;
        }

        .edit-btn {
            color: var(--color-orange);
            background: none;
            border: none;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .confirmation-content {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .order-item {
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .prepayment-info {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 24px;
            text-align: center;
        }

        .prepayment-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 15px;
        }

        .prepayment-note {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--text-muted);
        }

        /* ==================== –£–°–ü–ï–• ==================== */
        .success-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }

        .success-icon {
            width: 100px;
            height: 100px;
            margin-bottom: 24px;
        }

        .checkmark {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: block;
            stroke-width: 3;
            stroke: var(--color-success);
            stroke-miterlimit: 10;
            box-shadow: inset 0px 0px 0px var(--color-success);
            animation: fill 0.4s ease-in-out 0.4s forwards, scale 0.3s ease-in-out 0.9s both;
        }

        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 3;
            stroke-miterlimit: 10;
            stroke: var(--color-success);
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }

        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px var(--color-success);
            }
        }

        .success-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .success-order-number {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .success-message {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 32px;
        }

        .success-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 300px;
        }

        .manager-btn {
            padding: 16px;
            background: var(--gradient-main);
            border: none;
            border-radius: var(--border-radius-sm);
            color: white;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .home-btn {
            padding: 16px;
            background: transparent;
            border: 1px solid var(--text-muted);
            border-radius: var(--border-radius-sm);
            color: white;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
        }

        /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--color-orange);
            animation: confetti-fall 3s linear infinite;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* ==================== FOOTER ==================== */
        .footer {
            background: var(--bg-primary);
            padding: 40px 20px;
            border-top: 1px solid var(--text-muted);
            text-align: center;
        }

        .footer-info {
            margin-bottom: 24px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .footer-instagram {
            color: var(--color-orange);
            text-decoration: none;
            font-weight: 600;
        }

        .footer-btn {
            display: inline-block;
            padding: 14px 32px;
            background: var(--gradient-main);
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            margin-top: 16px;
        }

        /* ==================== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ==================== */
        @media (max-width: 380px) {
            .sizes-grid {
                grid-template-columns: 1fr;
            }

            .logo {
                font-size: 18px;
                letter-spacing: 2px;
            }

            .section-title {
                font-size: 20px;
            }
        }

        /* ==================== LOADING ==================== */
        .loading {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--text-muted);
            border-top-color: var(--color-orange);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
    </div>

    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="mainPage" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="logo">ARTHOLST</div>
            <div class="cart-icon" onclick="goToCart()">
                üõí
                <span class="cart-badge hidden" id="cartBadge">0</span>
            </div>
        </header>

        <!-- –ë–∞–Ω–Ω–µ—Ä—ã -->
        <section class="banners-section">
            <div class="banners-slider" id="bannersSlider"></div>
            <div class="banner-dots" id="bannerDots"></div>
        </section>

        <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ -->
        <section class="advantages-section">
            <h2 class="section-title">–ù–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h2>
            <div class="advantages-scroll" id="advantagesScroll"></div>
        </section>

        <!-- –ö–∞—Ç–∞–ª–æ–≥ -->
        <section class="catalog-section">
            <h2 class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–∏–Ω—ã</h2>
            <div class="sizes-grid" id="sizesGrid"></div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-info">
                Instagram: <a href="https://instagram.com/artholst_belarus" class="footer-instagram">@artholst_belarus</a><br>
                –†–∞–±–æ—Ç–∞–µ–º —Å 2018 –≥–æ–¥–∞<br>
                15 000+ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
            </div>
            <a href="https://t.me/oformitszakaz" class="footer-btn" target="_blank">üì± –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É</a>
        </footer>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ—Ä–∑–∏–Ω—ã -->
    <div id="cartPage" class="hidden">
        <header class="header">
            <div class="back-button" onclick="goToMain()">‚Üê</div>
            <div class="cart-title">–ö–æ—Ä–∑–∏–Ω–∞</div>
            <button class="clear-cart-btn" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </header>

        <div class="cart-page">
            <div id="cartItems"></div>

            <button class="add-more-btn" onclick="goToMain()">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –∫–∞—Ä—Ç–∏–Ω—É
            </button>

            <div class="promo-section">
                <div class="promo-input-group">
                    <input type="text" class="promo-input" id="promoInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
                    <button class="promo-apply-btn" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                </div>
                <div id="promoMessage"></div>
            </div>
        </div>

        <div class="cart-summary hidden" id="cartSummary">
            <div id="summaryContent"></div>
            <button class="checkout-btn" onclick="goToCheckout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è -->
    <div id="checkoutPage" class="hidden">
        <header class="header">
            <div class="back-button" onclick="goToCart()">‚Üê</div>
            <div class="cart-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</div>
        </header>

        <div class="checkout-page">
            <div class="progress-bar" id="progressBar"></div>
            <div id="checkoutContent"></div>
        </div>
    </div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        const tg = window.Telegram.WebApp;
        let config = null;
        let cart = [];
        let currentBanner = 0;
        let bannerInterval = null;
        let appliedPromo = null;
        let checkoutStep = 1;
        let checkoutData = {
            contact: {},
            delivery: {},
        };

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        async function init() {
            try {
                // Telegram WebApp Setup
                tg.ready();
                tg.expand();
                tg.setHeaderColor('#1a1a1a');
                tg.setBackgroundColor('#0a0a0a');

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
                const response = await fetch('config.json');
                config = await response.json();

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ localStorage
                const savedCart = localStorage.getItem('artholst_cart');
                if (savedCart) {
                    cart = JSON.parse(savedCart);
                }

                const savedPromo = localStorage.getItem('artholst_promo');
                if (savedPromo) {
                    appliedPromo = JSON.parse(savedPromo);
                }

                // –†–µ–Ω–¥–µ—Ä –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                renderBanners();
                renderAdvantages();
                renderSizes();
                startBannerSlider();
                updateCartBadge();

                // –°–∫—Ä—ã—Ç—å loading
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('mainPage').classList.remove('hidden');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        }

        // ==================== –ë–ê–ù–ù–ï–†–´ ====================
        function renderBanners() {
            const slider = document.getElementById('bannersSlider');
            const dots = document.getElementById('bannerDots');

            config.banners.forEach((banner, index) => {
                // –°–ª–∞–π–¥
                const slide = document.createElement('div');
                slide.className = `banner-slide ${index === 0 ? 'active' : ''}`;
                slide.style.background = banner.gradient;
                slide.onclick = () => openBannerModal(banner);

                slide.innerHTML = `
                    <div class="banner-content">
                        <div class="banner-icon">${banner.icon}</div>
                        <div class="banner-text">
                            <h3>${banner.title}</h3>
                            <p>${banner.subtitle}</p>
                        </div>
                    </div>
                `;

                slider.appendChild(slide);

                // –¢–æ—á–∫–∞
                const dot = document.createElement('div');
                dot.className = `banner-dot ${index === 0 ? 'active' : ''}`;
                dot.onclick = () => goToBanner(index);
                dots.appendChild(dot);
            });
        }

        function startBannerSlider() {
            bannerInterval = setInterval(() => {
                currentBanner = (currentBanner + 1) % config.banners.length;
                updateBannerSlide();
            }, 4000);
        }

        function goToBanner(index) {
            currentBanner = index;
            updateBannerSlide();
            clearInterval(bannerInterval);
            startBannerSlider();
        }

        function updateBannerSlide() {
            const slides = document.querySelectorAll('.banner-slide');
            const dots = document.querySelectorAll('.banner-dot');

            slides.forEach((slide, index) => {
                slide.classList.toggle('active', index === currentBanner);
            });

            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentBanner);
            });
        }

        function openBannerModal(banner) {
            tg.HapticFeedback.impactOccurred('medium');

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.onclick = (e) => {
                if (e.target === modal) closeModal(modal);
            };

            let promoHtml = '';
            if (banner.promo_code) {
                promoHtml = `
                    <div class="modal-promo">
                        <div style="color: var(--text-secondary);">–ü—Ä–æ–º–æ–∫–æ–¥:</div>
                        <div class="promo-code">${banner.promo_code}</div>
                        <button class="copy-promo-btn" onclick="copyPromoCode('${banner.promo_code}')">
                            üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
                        </button>
                    </div>
                `;
            }

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-close" onclick="closeModal(this.closest('.modal-overlay'))">√ó</div>
                    <div class="modal-header">
                        <div class="modal-icon">${banner.icon}</div>
                        <div class="modal-title">${banner.title}</div>
                    </div>
                    <div class="modal-body">${banner.full_description}</div>
                    ${promoHtml}
                </div>
            `;

            document.body.appendChild(modal);
        }

        function copyPromoCode(code) {
            navigator.clipboard.writeText(code);
            tg.HapticFeedback.notificationOccurred('success');
            tg.showAlert('–ü—Ä–æ–º–æ–∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + code);
        }

        // ==================== –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê ====================
        function renderAdvantages() {
            const scroll = document.getElementById('advantagesScroll');

            config.advantages.forEach(advantage => {
                const card = document.createElement('div');
                card.className = 'advantage-card';
                card.onclick = () => openAdvantageModal(advantage);

                card.innerHTML = `
                    <div class="advantage-icon">${advantage.icon}</div>
                    <div class="advantage-text">${advantage.short}</div>
                `;

                scroll.appendChild(card);
            });
        }

        function openAdvantageModal(advantage) {
            tg.HapticFeedback.impactOccurred('medium');

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.onclick = (e) => {
                if (e.target === modal) closeModal(modal);
            };

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-close" onclick="closeModal(this.closest('.modal-overlay'))">√ó</div>
                    <div class="modal-header">
                        <div class="modal-icon">${advantage.icon}</div>
                        <div class="modal-title">${advantage.title}</div>
                    </div>
                    <div class="modal-body">${advantage.full_description}</div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function closeModal(modal) {
            modal.remove();
        }

        // ==================== –ö–ê–¢–ê–õ–û–ì ====================
        function renderSizes() {
            const grid = document.getElementById('sizesGrid');

            config.sizes.forEach(size => {
                const card = document.createElement('div');
                card.className = 'size-card fade-in';

                let badges = '';
                if (size.hit) badges += '<span class="size-badge badge-hit">üî• –•–ò–¢</span>';
                if (size.popular) badges += '<span class="size-badge badge-popular">‚≠êÔ∏è –ü–û–ü–£–õ–Ø–†–ù–´–ô</span>';

                // SVG –∏–∫–æ–Ω–∫–∞ —Ö–æ–ª—Å—Ç–∞
                const aspectRatio = size.width / size.height;
                const svgWidth = aspectRatio > 1 ? 80 : 60;
                const svgHeight = aspectRatio > 1 ? 60 : 80;

                card.innerHTML = `
                    ${badges ? `<div class="size-badges">${badges}</div>` : ''}
                    <div class="size-canvas-icon">
                        <svg width="${svgWidth}" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}">
                            <rect x="2" y="2" width="${svgWidth - 4}" height="${svgHeight - 4}" 
                                  fill="none" stroke="url(#gradient)" stroke-width="3" rx="2"/>
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ff6b35;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <div class="size-name">${size.width}√ó${size.height} —Å–º</div>
                    <div class="size-price">${size.price} BYN</div>
                    <div class="size-info" onclick="showSizeInfo(event, ${size.packaging_price}, ${size.delivery_price})">
                        ‚ÑπÔ∏è –£–ø–∞–∫–æ–≤–∫–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞
                    </div>
                    <button class="add-to-cart-btn" onclick="addToCart(${size.width}, ${size.height}, ${size.price}, ${size.packaging_price}, ${size.delivery_price}, this)">
                        ‚ûï –í –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                `;

                grid.appendChild(card);
            });
        }

        function showSizeInfo(event, packagingPrice, deliveryPrice) {
            event.stopPropagation();
            tg.HapticFeedback.impactOccurred('light');
            tg.showAlert(`üéÅ –£–ø–∞–∫–æ–≤–∫–∞: ${packagingPrice} BYN\nüì¶ –î–æ—Å—Ç–∞–≤–∫–∞: –æ—Ç ${deliveryPrice} BYN`);
        }

        // ==================== –ö–û–†–ó–ò–ù–ê ====================
        function addToCart(width, height, price, packagingPrice, deliveryPrice, button) {
            tg.HapticFeedback.impactOccurred('medium');

            // Ripple —ç—Ñ—Ñ–µ–∫—Ç
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            const rect = button.getBoundingClientRect();
            ripple.style.left = event.clientX - rect.left + 'px';
            ripple.style.top = event.clientY - rect.top + 'px';
            button.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);

            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
            button.classList.add('added');
            button.innerHTML = '‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ';

            setTimeout(() => {
                button.classList.remove('added');
                button.innerHTML = '‚ûï –í –∫–æ—Ä–∑–∏–Ω—É';
            }, 1500);

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
            const item = {
                id: Date.now(),
                width,
                height,
                price,
                packagingPrice,
                deliveryPrice,
                hasPackaging: false,
                comment: ''
            };

            cart.push(item);
            saveCart();
            updateCartBadge();
        }

        function saveCart() {
            localStorage.setItem('artholst_cart', JSON.stringify(cart));
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            if (cart.length > 0) {
                badge.textContent = cart.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function goToCart() {
            tg.HapticFeedback.impactOccurred('medium');
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('cartPage').classList.remove('hidden');
            renderCart();
        }

        function goToMain() {
            tg.HapticFeedback.impactOccurred('medium');
            document.getElementById('cartPage').classList.add('hidden');
            document.getElementById('checkoutPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
        }

        function renderCart() {
            const container = document.getElementById('cartItems');

            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="cart-empty">
                        <div class="cart-empty-icon">üõí</div>
                        <div class="cart-empty-text">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
                        <button class="add-more-btn" onclick="goToMain()">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</button>
                    </div>
                `;
                document.getElementById('cartSummary').classList.add('hidden');
                return;
            }

            container.innerHTML = '';

            cart.forEach(item => {
                const div = document.createElement('div');
                div.className = 'cart-item';

                div.innerHTML = `
                    <div class="cart-item-header">
                        <div class="cart-item-icon">üñº</div>
                        <div class="cart-item-info">
                            <div class="cart-item-size">${item.width}√ó${item.height} —Å–º</div>
                            <div class="cart-item-price">${item.price} BYN</div>
                        </div>
                        <div class="cart-item-delete" onclick="removeFromCart(${item.id})">üóë</div>
                    </div>

                    <div class="packaging-toggle" onclick="togglePackaging(${item.id})">
                        <div class="toggle-switch ${item.hasPackaging ? 'active' : ''}">
                            <div class="toggle-slider"></div>
                        </div>
                        <div class="toggle-label">üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞</div>
                        <div class="toggle-price">+${item.packagingPrice} BYN</div>
                    </div>

                    <textarea class="cart-item-comment" placeholder="–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ—Ç–æ?" 
                              oninput="updateComment(${item.id}, this.value)">${item.comment}</textarea>
                    
                    <div class="photo-note">üìé –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</div>
                `;

                container.appendChild(div);
            });

            renderCartSummary();
            document.getElementById('cartSummary').classList.remove('hidden');
        }

        function togglePackaging(id) {
            tg.HapticFeedback.impactOccurred('light');
            const item = cart.find(i => i.id === id);
            if (item) {
                item.hasPackaging = !item.hasPackaging;
                saveCart();
                renderCart();
            }
        }

        function updateComment(id, value) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.comment = value;
                saveCart();
            }
        }

        function removeFromCart(id) {
            tg.HapticFeedback.impactOccurred('medium');
            cart = cart.filter(i => i.id !== id);
            saveCart();
            updateCartBadge();
            renderCart();
        }

        function clearCart() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')) {
                tg.HapticFeedback.impactOccurred('medium');
                cart = [];
                appliedPromo = null;
                saveCart();
                localStorage.removeItem('artholst_promo');
                updateCartBadge();
                renderCart();
            }
        }

        function renderCartSummary() {
            const content = document.getElementById('summaryContent');

            const itemsTotal = cart.reduce((sum, item) => sum + item.price, 0);
            const packagingTotal = cart.reduce((sum, item) => sum + (item.hasPackaging ? item.packagingPrice : 0), 0);

            let discount = 0;
            let discountHtml = '';

            // –ê–≤—Ç–æ—Å–∫–∏–¥–∫–∞ 15% –ø—Ä–∏ 3+ –∫–∞—Ä—Ç–∏–Ω–∞—Ö
            if (cart.length >= 3) {
                discount = (itemsTotal + packagingTotal) * 0.15;
                discountHtml = '<div class="summary-row discount">–°–∫–∏–¥–∫–∞ 15% (3+ –∫–∞—Ä—Ç–∏–Ω): -' + discount.toFixed(2) + ' BYN</div>';
            }

            // –ü—Ä–æ–º–æ–∫–æ–¥
            if (appliedPromo) {
                const promoDiscount = (itemsTotal + packagingTotal) * (appliedPromo.discount_percent / 100);
                discount += promoDiscount;
                discountHtml += '<div class="summary-row discount">–ü—Ä–æ–º–æ–∫–æ–¥ ' + appliedPromo.code + ': -' + promoDiscount.toFixed(2) + ' BYN</div>';
            }

            const total = itemsTotal + packagingTotal - discount;

            content.innerHTML = `
                <div class="summary-row">
                    <span>–¢–æ–≤–∞—Ä—ã (${cart.length} —à—Ç.):</span>
                    <span>${itemsTotal} BYN</span>
                </div>
                ${packagingTotal > 0 ? `<div class="summary-row"><span>–£–ø–∞–∫–æ–≤–∫–∞:</span><span>${packagingTotal} BYN</span></div>` : ''}
                ${discountHtml}
                <div class="summary-total">
                    <div class="summary-total-label">–ò—Ç–æ–≥–æ:</div>
                    <div class="summary-total-price">${total.toFixed(2)} BYN</div>
                </div>
            `;
        }

        function applyPromo() {
            const input = document.getElementById('promoInput');
            const code = input.value.trim().toUpperCase();
            const messageDiv = document.getElementById('promoMessage');

            if (!code) {
                messageDiv.innerHTML = '<div class="promo-message error">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥</div>';
                return;
            }

            const promoConfig = config.promo_codes[code];

            if (!promoConfig) {
                tg.HapticFeedback.notificationOccurred('error');
                messageDiv.innerHTML = '<div class="promo-message error">–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω</div>';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
            const today = new Date().getDay();
            if (promoConfig.valid_days && !promoConfig.valid_days.includes(today)) {
                tg.HapticFeedback.notificationOccurred('error');
                const days = promoConfig.valid_days.map(d => ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'][d]).join(' –∏ ');
                messageDiv.innerHTML = `<div class="promo-message error">–ü—Ä–æ–º–æ–∫–æ–¥ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ ${days}</div>`;
                return;
            }

            tg.HapticFeedback.notificationOccurred('success');
            appliedPromo = { code, ...promoConfig };
            localStorage.setItem('artholst_promo', JSON.stringify(appliedPromo));

            messageDiv.innerHTML = `<div class="promo-message success">‚úì –°–∫–∏–¥–∫–∞ ${promoConfig.discount_percent}% –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!</div>`;
            renderCartSummary();
        }

        // ==================== –û–§–û–†–ú–õ–ï–ù–ò–ï ====================
        function goToCheckout() {
            if (cart.length === 0) return;

            tg.HapticFeedback.impactOccurred('medium');
            checkoutStep = 1;
            document.getElementById('cartPage').classList.add('hidden');
            document.getElementById('checkoutPage').classList.remove('hidden');
            renderCheckoutStep();
        }

        function renderCheckoutStep() {
            renderProgressBar();

            const content = document.getElementById('checkoutContent');

            if (checkoutStep === 1) {
                content.innerHTML = `
                    <div class="checkout-form">
                        <h3 class="form-title">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                        <div class="form-group">
                            <label class="form-label">–§–ò–û *</label>
                            <input type="text" class="form-input" id="fullName" value="${checkoutData.contact.fullName || ''}" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" class="form-input" id="phone" value="${checkoutData.contact.phone || ''}" placeholder="+375 (__)  ___-__-__">
                        </div>
                    </div>
                    <button class="next-step-btn" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                `;

                // –ú–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                const phoneInput = document.getElementById('phone');
                phoneInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 0 && value[0] !== '3') {
                        value = '375' + value;
                    }
                    if (value.length > 12) value = value.substr(0, 12);

                    let formatted = '+375';
                    if (value.length > 3) formatted += ' (' + value.substr(3, 2);
                    if (value.length > 5) formatted += ') ' + value.substr(5, 3);
                    if (value.length > 8) formatted += '-' + value.substr(8, 2);
                    if (value.length > 10) formatted += '-' + value.substr(10, 2);

                    e.target.value = formatted;
                });
            } else if (checkoutStep === 2) {
                renderDeliveryStep(content);
            } else if (checkoutStep === 3) {
                renderConfirmationStep(content);
            }
        }

        function renderProgressBar() {
            const bar = document.getElementById('progressBar');
            const steps = [
                { num: 1, label: '–ö–æ–Ω—Ç–∞–∫—Ç—ã' },
                { num: 2, label: '–î–æ—Å—Ç–∞–≤–∫–∞' },
                { num: 3, label: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ' }
            ];

            bar.innerHTML = steps.map(step => `
                <div class="progress-step ${step.num === checkoutStep ? 'active' : ''} ${step.num < checkoutStep ? 'completed' : ''}">
                    <div class="progress-circle">${step.num < checkoutStep ? '‚úì' : step.num}</div>
                    <div class="progress-label">${step.label}</div>
                    <div class="progress-line"></div>
                </div>
            `).join('');
        }

        function nextStep() {
            if (checkoutStep === 1) {
                const fullName = document.getElementById('fullName').value.trim();
                const phone = document.getElementById('phone').value.trim();

                if (!fullName || !phone) {
                    tg.HapticFeedback.notificationOccurred('error');
                    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }

                checkoutData.contact = { fullName, phone };
            } else if (checkoutStep === 2) {
                if (!checkoutData.delivery.method) {
                    tg.HapticFeedback.notificationOccurred('error');
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏');
                    return;
                }

                if (checkoutData.delivery.method === 'courier') {
                    const street = document.getElementById('street')?.value.trim();
                    const house = document.getElementById('house')?.value.trim();

                    if (!street || !house) {
                        tg.HapticFeedback.notificationOccurred('error');
                        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏');
                        return;
                    }

                    checkoutData.delivery.address = {
                        street,
                        house,
                        entrance: document.getElementById('entrance')?.value || '',
                        floor: document.getElementById('floor')?.value || '',
                        apartment: document.getElementById('apartment')?.value || '',
                        outsideMkad: document.getElementById('outsideMkad')?.checked || false
                    };
                } else if (checkoutData.delivery.method === 'post') {
                    const fullAddress = document.getElementById('fullAddress')?.value.trim();
                    const zipCode = document.getElementById('zipCode')?.value.trim();

                    if (!fullAddress || !zipCode) {
                        tg.HapticFeedback.notificationOccurred('error');
                        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–¥—Ä–µ—Å –∏ –∏–Ω–¥–µ–∫—Å');
                        return;
                    }

                    checkoutData.delivery.address = { fullAddress, zipCode };
                }
            }

            tg.HapticFeedback.impactOccurred('medium');
            checkoutStep++;
            renderCheckoutStep();
        }

        function prevStep() {
            tg.HapticFeedback.impactOccurred('medium');
            checkoutStep--;
            renderCheckoutStep();
        }

        function renderDeliveryStep(content) {
            const itemsTotal = cart.reduce((sum, item) => sum + item.price, 0);
            const packagingTotal = cart.reduce((sum, item) => sum + (item.hasPackaging ? item.packagingPrice : 0), 0);

            let discount = 0;
            if (cart.length >= 3) discount += (itemsTotal + packagingTotal) * 0.15;
            if (appliedPromo) discount += (itemsTotal + packagingTotal) * (appliedPromo.discount_percent / 100);

            const subtotal = itemsTotal + packagingTotal - discount;
            const isFreeDelivery = subtotal >= config.delivery.free_from;

            // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –ë–µ–ª–ø–æ—á—Ç–æ–π
            let postPrice = 0;
            if (!isFreeDelivery) {
                const deliveryPrices = cart.map(item => item.deliveryPrice);
                const maxPrice = Math.max(...deliveryPrices);
                postPrice = maxPrice;

                deliveryPrices.forEach(price => {
                    if (price !== maxPrice) {
                        postPrice += price * 0.5;
                    }
                });
            }

            const courierPrice = isFreeDelivery ? 0 : config.delivery.courier_minsk.inside_mkad;
            const courierOutsidePrice = isFreeDelivery ? 0 : config.delivery.courier_minsk.outside_mkad;

            content.innerHTML = `
                <div class="checkout-form">
                    <h3 class="form-title">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
                    <div class="delivery-options">
                        <div class="delivery-option" onclick="selectDelivery('courier')">
                            <div class="delivery-option-header">
                                <div class="delivery-option-name">üöó –ö—É—Ä—å–µ—Ä –ø–æ –ú–∏–Ω—Å–∫—É</div>
                                ${isFreeDelivery ? '<span class="delivery-badge">–ë–ï–°–ü–õ–ê–¢–ù–û</span>' : `<div class="delivery-option-price">${courierPrice} BYN</div>`}
                            </div>
                            <div class="delivery-option-details">–í –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î</div>
                        </div>

                        <div class="delivery-option" onclick="selectDelivery('pickup')">
                            <div class="delivery-option-header">
                                <div class="delivery-option-name">üìç –°–∞–º–æ–≤—ã–≤–æ–∑</div>
                                <span class="delivery-badge">–ë–ï–°–ü–õ–ê–¢–ù–û</span>
                            </div>
                            <div class="delivery-option-details">${config.delivery.pickup.address}</div>
                        </div>

                        <div class="delivery-option" onclick="selectDelivery('post')">
                            <div class="delivery-option-header">
                                <div class="delivery-option-name">üìÆ –ë–µ–ª–ø–æ—á—Ç–∞</div>
                                ${isFreeDelivery ? '<span class="delivery-badge">–ë–ï–°–ü–õ–ê–¢–ù–û</span>' : `<div class="delivery-option-price">${postPrice.toFixed(2)} BYN</div>`}
                            </div>
                            <div class="delivery-option-details">–ü–æ –≤—Å–µ–π –ë–µ–ª–∞—Ä—É—Å–∏</div>
                        </div>
                    </div>
                    <div id="deliveryFields"></div>
                </div>
                <button class="next-step-btn" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                <button class="prev-step-btn" onclick="prevStep()">‚Üê –ù–∞–∑–∞–¥</button>
            `;
        }

        function selectDelivery(method) {
            tg.HapticFeedback.impactOccurred('light');

            document.querySelectorAll('.delivery-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            event.currentTarget.classList.add('selected');
            checkoutData.delivery.method = method;

            const fieldsDiv = document.getElementById('deliveryFields');

            if (method === 'courier') {
                fieldsDiv.innerHTML = `
                    <div class="delivery-fields">
                        <div class="form-group">
                            <label class="form-label">–£–ª–∏—Ü–∞ *</label>
                            <input type="text" class="form-input" id="street" value="${checkoutData.delivery.address?.street || ''}" placeholder="–ü—Ä–æ—Å–ø–µ–∫—Ç –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–î–æ–º *</label>
                            <input type="text" class="form-input" id="house" value="${checkoutData.delivery.address?.house || ''}" placeholder="25">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ü–æ–¥—ä–µ–∑–¥, –≠—Ç–∞–∂, –ö–≤–∞—Ä—Ç–∏—Ä–∞</label>
                            <input type="text" class="form-input" id="entrance" value="${checkoutData.delivery.address?.entrance || ''}" placeholder="1">
                            <input type="text" class="form-input" id="floor" value="${checkoutData.delivery.address?.floor || ''}" placeholder="5">
                            <input type="text" class="form-input" id="apartment" value="${checkoutData.delivery.address?.apartment || ''}" placeholder="42">
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="outsideMkad" ${checkoutData.delivery.address?.outsideMkad ? 'checked' : ''}>
                            <label for="outsideMkad">–ó–∞ –ú–ö–ê–î (–¥–æ 5 –∫–º) ‚Äî +5 BYN</label>
                        </div>
                    </div>
                `;
            } else if (method === 'post') {
                fieldsDiv.innerHTML = `
                    <div class="delivery-fields">
                        <div class="form-group">
                            <label class="form-label">–ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å *</label>
                            <input type="text" class="form-input" id="fullAddress" value="${checkoutData.delivery.address?.fullAddress || ''}" placeholder="–≥. –ì—Ä–æ–¥–Ω–æ, —É–ª. –°–æ–≤–µ—Ç—Å–∫–∞—è, –¥. 10, –∫–≤. 5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ò–Ω–¥–µ–∫—Å *</label>
                            <input type="text" class="form-input" id="zipCode" value="${checkoutData.delivery.address?.zipCode || ''}" placeholder="220000">
                        </div>
                    </div>
                `;
            } else {
                fieldsDiv.innerHTML = '';
            }
        }

        function renderConfirmationStep(content) {
            const itemsTotal = cart.reduce((sum, item) => sum + item.price, 0);
            const packagingTotal = cart.reduce((sum, item) => sum + (item.hasPackaging ? item.packagingPrice : 0), 0);

            let discount = 0;
            if (cart.length >= 3) discount += (itemsTotal + packagingTotal) * 0.15;
            if (appliedPromo) discount += (itemsTotal + packagingTotal) * (appliedPromo.discount_percent / 100);

            const subtotal = itemsTotal + packagingTotal - discount;

            // –†–∞—Å—á–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏
            let deliveryPrice = 0;
            let deliveryName = '';

            if (checkoutData.delivery.method === 'courier') {
                deliveryName = '–ö—É—Ä—å–µ—Ä –ø–æ –ú–∏–Ω—Å–∫—É';
                if (subtotal < config.delivery.free_from) {
                    deliveryPrice = checkoutData.delivery.address.outsideMkad 
                        ? config.delivery.courier_minsk.outside_mkad 
                        : config.delivery.courier_minsk.inside_mkad;
                }
            } else if (checkoutData.delivery.method === 'pickup') {
                deliveryName = '–°–∞–º–æ–≤—ã–≤–æ–∑';
                deliveryPrice = 0;
            } else if (checkoutData.delivery.method === 'post') {
                deliveryName = '–ë–µ–ª–ø–æ—á—Ç–∞';
                if (subtotal < config.delivery.free_from) {
                    const deliveryPrices = cart.map(item => item.deliveryPrice);
                    const maxPrice = Math.max(...deliveryPrices);
                    deliveryPrice = maxPrice;
                    deliveryPrices.forEach(price => {
                        if (price !== maxPrice) deliveryPrice += price * 0.5;
                    });
                }
            }

            const total = subtotal + deliveryPrice;
            const prepayment = total * 0.5;
            const onDelivery = total - prepayment;

            const orderItems = cart.map((item, i) => `
                <div class="order-item">
                    ${i + 1}. ${item.width}√ó${item.height} —Å–º ‚Äî ${item.price} BYN<br>
                    ${item.hasPackaging ? 'üéÅ –° —É–ø–∞–∫–æ–≤–∫–æ–π (+' + item.packagingPrice + ' BYN)<br>' : ''}
                    ${item.comment ? 'üí¨ ' + item.comment : ''}
                </div>
            `).join('');

            let addressText = '';
            if (checkoutData.delivery.method === 'courier') {
                const addr = checkoutData.delivery.address;
                addressText = `${addr.street}, –¥. ${addr.house}${addr.entrance ? ', –ø–æ–¥—ä–µ–∑–¥ ' + addr.entrance : ''}${addr.floor ? ', —ç—Ç–∞–∂ ' + addr.floor : ''}${addr.apartment ? ', –∫–≤. ' + addr.apartment : ''}`;
            } else if (checkoutData.delivery.method === 'post') {
                addressText = checkoutData.delivery.address.fullAddress + ', ' + checkoutData.delivery.address.zipCode;
            } else {
                addressText = config.delivery.pickup.address;
            }

            content.innerHTML = `
                <div class="confirmation-card">
                    <div class="confirmation-header">
                        <div class="confirmation-title">üì¶ –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</div>
                    </div>
                    <div class="confirmation-content">
                        ${orderItems}
                    </div>
                </div>

                <div class="confirmation-card">
                    <div class="confirmation-header">
                        <div class="confirmation-title">üë§ –ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
                        <button class="edit-btn" onclick="editStep(1)">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                    </div>
                    <div class="confirmation-content">
                        –§–ò–û: ${checkoutData.contact.fullName}<br>
                        –¢–µ–ª–µ—Ñ–æ–Ω: ${checkoutData.contact.phone}
                    </div>
                </div>

                <div class="confirmation-card">
                    <div class="confirmation-header">
                        <div class="confirmation-title">üöö –î–æ—Å—Ç–∞–≤–∫–∞</div>
                        <button class="edit-btn" onclick="editStep(2)">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                    </div>
                    <div class="confirmation-content">
                        ${deliveryName}<br>
                        ${addressText}<br>
                        –°—Ç–æ–∏–º–æ—Å—Ç—å: ${deliveryPrice === 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : deliveryPrice.toFixed(2) + ' BYN'}
                    </div>
                </div>

                <div class="prepayment-info">
                    <div class="prepayment-row">
                        <span>–¢–æ–≤–∞—Ä—ã:</span>
                        <span>${itemsTotal} BYN</span>
                    </div>
                    ${packagingTotal > 0 ? `<div class="prepayment-row"><span>–£–ø–∞–∫–æ–≤–∫–∞:</span><span>${packagingTotal} BYN</span></div>` : ''}
                    ${discount > 0 ? `<div class="prepayment-row" style="color: var(--color-success)"><span>–°–∫–∏–¥–∫–∞:</span><span>-${discount.toFixed(2)} BYN</span></div>` : ''}
                    ${deliveryPrice > 0 ? `<div class="prepayment-row"><span>–î–æ—Å—Ç–∞–≤–∫–∞:</span><span>${deliveryPrice.toFixed(2)} BYN</span></div>` : ''}
                    <div class="prepayment-row" style="font-size: 20px; font-weight: 700; border-top: 1px solid var(--text-muted); padding-top: 12px; margin-top: 12px;">
                        <span>–ò–¢–û–ì–û:</span>
                        <span style="background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${total.toFixed(2)} BYN</span>
                    </div>
                    <div class="prepayment-row" style="margin-top: 16px;">
                        <span>üí≥ –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 50%:</span>
                        <span>${prepayment.toFixed(2)} BYN</span>
                    </div>
                    <div class="prepayment-row">
                        <span>üíµ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏:</span>
                        <span>${onDelivery.toFixed(2)} BYN</span>
                    </div>
                    <div class="prepayment-note">
                        ‚ö†Ô∏è –û–ø–ª–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–∞–∫–µ—Ç–∞
                    </div>
                </div>

                <button class="next-step-btn" onclick="submitOrder()">‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
                <button class="prev-step-btn" onclick="prevStep()">‚Üê –ù–∞–∑–∞–¥</button>
            `;
        }

        function editStep(step) {
            tg.HapticFeedback.impactOccurred('medium');
            checkoutStep = step;
            renderCheckoutStep();
        }

        function submitOrder() {
            tg.HapticFeedback.notificationOccurred('success');

            const orderId = Date.now();

            const itemsTotal = cart.reduce((sum, item) => sum + item.price, 0);
            const packagingTotal = cart.reduce((sum, item) => sum + (item.hasPackaging ? item.packagingPrice : 0), 0);

            let discount = 0;
            if (cart.length >= 3) discount += (itemsTotal + packagingTotal) * 0.15;
            if (appliedPromo) discount += (itemsTotal + packagingTotal) * (appliedPromo.discount_percent / 100);

            const subtotal = itemsTotal + packagingTotal - discount;

            let deliveryPrice = 0;
            let deliveryName = '';

            if (checkoutData.delivery.method === 'courier') {
                deliveryName = '–ö—É—Ä—å–µ—Ä –ø–æ –ú–∏–Ω—Å–∫—É';
                if (subtotal < config.delivery.free_from) {
                    deliveryPrice = checkoutData.delivery.address.outsideMkad 
                        ? config.delivery.courier_minsk.outside_mkad 
                        : config.delivery.courier_minsk.inside_mkad;
                }
            } else if (checkoutData.delivery.method === 'pickup') {
                deliveryName = '–°–∞–º–æ–≤—ã–≤–æ–∑';
            } else if (checkoutData.delivery.method === 'post') {
                deliveryName = '–ë–µ–ª–ø–æ—á—Ç–∞';
                if (subtotal < config.delivery.free_from) {
                    const deliveryPrices = cart.map(item => item.deliveryPrice);
                    const maxPrice = Math.max(...deliveryPrices);
                    deliveryPrice = maxPrice;
                    deliveryPrices.forEach(price => {
                        if (price !== maxPrice) deliveryPrice += price * 0.5;
                    });
                }
            }

            const total = subtotal + deliveryPrice;

            let addressText = '';
            if (checkoutData.delivery.method === 'courier') {
                const addr = checkoutData.delivery.address;
                addressText = `${addr.street}, –¥. ${addr.house}${addr.entrance ? ', –ø–æ–¥—ä–µ–∑–¥ ' + addr.entrance : ''}${addr.floor ? ', —ç—Ç–∞–∂ ' + addr.floor : ''}${addr.apartment ? ', –∫–≤. ' + addr.apartment : ''}`;
            } else if (checkoutData.delivery.method === 'post') {
                addressText = checkoutData.delivery.address.fullAddress + ', ' + checkoutData.delivery.address.zipCode;
            } else {
                addressText = config.delivery.pickup.address;
            }

            const orderItems = cart.map((item, i) => 
                `${i + 1}Ô∏è‚É£ –†–∞–∑–º–µ—Ä: ${item.width}√ó${item.height} —Å–º\n   –¶–µ–Ω–∞: ${item.price} BYN\n   ${item.hasPackaging ? 'üéÅ –£–ø–∞–∫–æ–≤–∫–∞: –î–∞ (+' + item.packagingPrice + ' BYN)' : 'üéÅ –£–ø–∞–∫–æ–≤–∫–∞: –ù–µ—Ç'}\n   üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${item.comment || '‚Äî'}`
            ).join('\n\n');

            let promoText = '';
            if (appliedPromo) {
                promoText = `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüè∑ –ü–†–û–ú–û–ö–û–î\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code}\n–°–∫–∏–¥–∫–∞: ${appliedPromo.discount_percent}% (-${((itemsTotal + packagingTotal) * (appliedPromo.discount_percent / 100)).toFixed(2)} BYN)\n\n`;
            }

            const user = tg.initDataUnsafe.user || {};

            const message = `üé® –ù–û–í–´–ô –ó–ê–ö–ê–ó #${orderId}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë§ –ö–õ–ò–ï–ù–¢
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–§–ò–û: ${checkoutData.contact.fullName}
–¢–µ–ª–µ—Ñ–æ–Ω: ${checkoutData.contact.phone}
Telegram ID: ${user.id || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
Username: @${user.username || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üì¶ –ó–ê–ö–ê–ó
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

${orderItems}

${promoText}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üöö –î–û–°–¢–ê–í–ö–ê
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–°–ø–æ—Å–æ–±: ${deliveryName}
–ê–¥—Ä–µ—Å: ${addressText}
–°—Ç–æ–∏–º–æ—Å—Ç—å: ${deliveryPrice === 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : deliveryPrice.toFixed(2) + ' BYN'}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí∞ –†–ê–°–ß–Å–¢
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–¢–æ–≤–∞—Ä—ã:    ${itemsTotal} BYN
–£–ø–∞–∫–æ–≤–∫–∞:  ${packagingTotal} BYN
–°–∫–∏–¥–∫–∞:    -${discount.toFixed(2)} BYN
–î–æ—Å—Ç–∞–≤–∫–∞:  ${deliveryPrice === 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : deliveryPrice.toFixed(2) + ' BYN'}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û:     ${total.toFixed(2)} BYN

üí≥ –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 50%:  ${(total * 0.5).toFixed(2)} BYN
üíµ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏:   ${(total * 0.5).toFixed(2)} BYN

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚è∞ ${new Date().toLocaleString('ru-RU')}

üì∏ –û–∂–∏–¥–∞–µ–º —Ñ–æ—Ç–æ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞`;

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –±–æ—Ç–∞
            tg.sendData(JSON.stringify({
                orderId,
                message,
                contact: checkoutData.contact,
                delivery: checkoutData.delivery,
                cart,
                total,
                user
            }));

            // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            cart = [];
            appliedPromo = null;
            checkoutData = { contact: {}, delivery: {} };
            localStorage.removeItem('artholst_cart');
            localStorage.removeItem('artholst_promo');

            // –ü–æ–∫–∞–∑ —É—Å–ø–µ—Ö–∞
            showSuccess(orderId);
        }

        function showSuccess(orderId) {
            const overlay = document.createElement('div');
            overlay.className = 'success-overlay';

            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = i % 2 === 0 ? 'var(--color-orange)' : 'var(--color-purple)';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                overlay.appendChild(confetti);
            }

            overlay.innerHTML += `
                <div class="success-icon">
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                </div>
                <div class="success-title">–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!</div>
                <div class="success-order-number">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: #${orderId}</div>
                <div class="success-message">
                    –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ Telegram –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–∞–∫–µ—Ç–∞.<br>
                    –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä—É.
                </div>
                <div class="success-buttons">
                    <a href="https://t.me/oformitszakaz" class="manager-btn" target="_blank">
                        üì± –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É
                    </a>
                    <button class="home-btn" onclick="location.reload()">
                        üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
                    </button>
                </div>
            `;

            document.body.appendChild(overlay);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>
